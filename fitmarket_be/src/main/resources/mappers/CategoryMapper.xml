<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.fitmarket_be.category.repository.CategoryMapper">

    <!-- ResultMap for ProductCategory -->
    <resultMap id="productCategoryResultMap" type="com.ssafy.fitmarket_be.category.domain.ProductCategory">
        <id property="id" column="id"/>
        <result property="parentId" column="parent_id"/>
        <result property="name" column="name"/>
        <result property="createdDate" column="created_date"/>
        <result property="modifiedDate" column="modified_date"/>
        <result property="deletedDate" column="deleted_date"/>
        <result property="productCount" column="product_count"/>
    </resultMap>

    <!-- 모든 카테고리 조회 (상품 개수 포함) -->
    <select id="selectAllCategoriesWithProductCount" resultMap="productCategoryResultMap">
        SELECT
            pc.id,
            pc.parent_id,
            pc.name,
            pc.created_date,
            pc.modified_date,
            pc.deleted_date,
            COUNT(p.id) AS product_count
        FROM product_categories pc
        LEFT JOIN products p ON pc.id = p.product_category_id AND p.deleted_date IS NULL
        WHERE pc.deleted_date IS NULL
        GROUP BY pc.id, pc.parent_id, pc.name, pc.created_date, pc.modified_date, pc.deleted_date
        ORDER BY pc.id ASC
    </select>

</mapper>